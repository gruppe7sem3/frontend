<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theater Seat Booking</title>
    <style>
        /* Add your CSS styling for seats here */
        .seat-container {
            display: grid;
            grid-template-columns: repeat(25, 30px); /* Adjust seat size and columns as needed */
            gap: 5px;
            justify-content: center;
        }

        .seat {
            width: 30px;
            height: 30px;
            background-color: #ccc;
            border: 1px solid #999;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease-in-out;
        }

        .selected {
            background-color: #ff8f00; /* Selected seat color */
            color: #fff;
        }

        .booked {
            background-color: #999; /* Booked seat color */
            cursor: not-allowed;
        }

        /* Center align the seat numbers */
        .seat-number {
            position: absolute;
            transform: translate(-50%, -50%);
        }

        #seat-container {
            text-align: center;
            margin: auto;
        }
    </style>
</head>
<body>
    <h1>Theater Seat Booking</h1>
    <div id="seat-container" class="seat-container">
        <!-- Your seats will be dynamically generated here using JavaScript -->
    </div>
    <p>Selected Seats: <span id="selected-seats">0</span></p>
    <p id="click-message"></p> <!-- Display the click message here -->
    <button id="book-btn">Book</button>

    <script>
        // Define the number of rows and seats per row
        const numRows = 20;
        const seatsPerRow = 25;
    
        const seatContainer = document.getElementById("seat-container");
        const selectedSeatsCount = document.getElementById("selected-seats");
        const bookButton = document.getElementById("book-btn");
        const clickMessage = document.getElementById("click-message");
    
        let selectedSeats = [];
    
        // Function to fetch booking information for a specific show
        async function fetchBookingsForShow(showId) {
            try {
                const response = await fetch(`http://localhost:2222/api/bookings/seatIdsForShow/${showId}`);
                if (!response.ok) {
                    throw new Error("Failed to fetch booking information");
                }
                const seatIds = await response.json();
                return seatIds;
            } catch (error) {
                console.error(error);
                return [];
            }
        }
    
        // Wrap the code in an async function
        async function initializeSeats() {
            // Fetch booking information for a specific show (show ID 1)
            const showId = 1;
            const bookedSeatIds = await fetchBookingsForShow(showId);
    
            let seatIdCounter = 1; // Initialize the seat ID counter
    
            // Create the theater seats dynamically
            for (let row = 1; row <= numRows; row++) {
                for (let seat = 1; seat <= seatsPerRow; seat++) {
                    const seatElement = document.createElement("div");
                    seatElement.classList.add("seat");
                    seatElement.dataset.row = row;
                    seatElement.dataset.column = seat; // Assign column number
                    seatElement.id = `seat-${row}-${seatIdCounter}`; // Assign unique ID
                    seatContainer.appendChild(seatElement);
    
                    const seatNumberElement = document.createElement("span");
                    seatNumberElement.classList.add("seat-number");
                    seatElement.appendChild(seatNumberElement);
    
                    // Check if the seat is booked for the show and add the "booked" class
                    if (bookedSeatIds.includes(seatIdCounter)) {
                        seatElement.classList.add("booked");
                    }
    
                    seatIdCounter++; // Increment seat ID counter
                }
            }
    
            // Add event listener to seats
            const seats = document.querySelectorAll(".seat");
            seats.forEach((seat) => {
                seat.addEventListener("click", () => {
                    if (!seat.classList.contains("booked")) {
                        seat.classList.toggle("selected");
                        updateSelectedSeats();
                        showClickMessage(seat.dataset.row, seat.dataset.column);
                    }
                });
            });
        }
    
        // Call the async function to initialize seats
        initializeSeats();
    
        // Update the selected seats count
        function updateSelectedSeats() {
            selectedSeats = document.querySelectorAll(".seat.selected");
            selectedSeatsCount.textContent = selectedSeats.length;
        }
    
        // Show click message with row and column numbers
        function showClickMessage(row, column) {
            clickMessage.textContent = `You clicked on seat in Row ${row}, Column ${column}`;
        }
    
        // Book button click event
        bookButton.addEventListener("click", () => {
            // You can implement the booking logic here based on the selected seats
            const selectedSeatIds = Array.from(selectedSeats).map((seat) => seat.id);
            alert(`You have booked the following seats: ${selectedSeatIds.join(", ")}`);
        });
    </script>
    
</body>
</html>
